<div class="registration-container">
  <h2>‚ûï Register New Employee</h2>

  <!-- Step 1: Form -->
  <div class="registration-form" *ngIf="step === 'form'">
    <div class="card">
      <h3>Employee Information</h3>
      
      <div class="form-group">
        <label>Employee Code *</label>
        <input type="text" [(ngModel)]="employee.employee_code" placeholder="EMP001" required>
      </div>

      <div class="form-group">
        <label>Full Name *</label>
        <input type="text" [(ngModel)]="employee.full_name" placeholder="Nguy·ªÖn VƒÉn A" required>
      </div>

      <div class="form-group">
        <label>Email</label>
        <input type="email" [(ngModel)]="employee.email" placeholder="nguyenvana@example.com">
      </div>

      <div class="form-group">
        <label>Phone</label>
        <input type="tel" [(ngModel)]="employee.phone" placeholder="0912345678">
      </div>

      <div class="form-group">
        <label>Department</label>
        <input type="text" [(ngModel)]="employee.department" placeholder="IT Department">
      </div>

      <div class="form-group">
        <label>Position</label>
        <input type="text" [(ngModel)]="employee.position" placeholder="Developer">
      </div>

      <!-- Registration Mode Selection -->
      <div class="mode-selection">
        <h4>Registration Method</h4>
        <div class="mode-buttons">
          <button 
            class="mode-btn" 
            [class.active]="registrationMode === 'upload'"
            (click)="registrationMode = 'upload'; errorMessage = ''">
            üì§ Upload Images
            <small>Upload 5-30 photos</small>
          </button>
          <button 
            class="mode-btn" 
            [class.active]="registrationMode === 'camera'"
            (click)="registrationMode = 'camera'; errorMessage = ''">
            üì∏ Camera Scan
            <small>iPhone-style circular scan</small>
          </button>
        </div>
      </div>

      <!-- Upload Images Mode -->
      <div *ngIf="registrationMode === 'upload'" class="upload-section">
        <div class="file-input-wrapper">
          <input 
            #fileInput
            type="file" 
            multiple 
            accept="image/jpeg,image/jpg,image/png"
            (change)="onFileSelect($event)"
            id="imageUpload"
            style="display: none;">
          <label for="imageUpload" class="file-input-label">
            <span class="upload-icon">üìÅ</span>
            <span>Choose Images (5-30 photos)</span>
          </label>
        </div>

        <!-- Selected Files Preview -->
        <div *ngIf="selectedFiles.length > 0" class="files-preview">
          <div class="preview-header">
            <span>Selected: {{ selectedFiles.length }} images</span>
            <button class="btn-remove" (click)="removeFiles()">Remove All</button>
          </div>
          <div class="preview-grid">
            <div *ngFor="let url of previewUrls" class="preview-item">
              <img [src]="url" alt="Preview">
            </div>
            <div *ngIf="selectedFiles.length > 10" class="preview-item more">
              +{{ selectedFiles.length - 10 }} more
            </div>
          </div>
        </div>
      </div>

      <div class="error" *ngIf="errorMessage">
        ‚ö†Ô∏è {{ errorMessage }}
      </div>

      <div class="button-group">
        <!-- Upload Mode Button -->
        <button 
          *ngIf="registrationMode === 'upload'"
          class="btn btn-primary" 
          (click)="submitWithImages()"
          [disabled]="selectedFiles.length < 5">
          ‚úÖ Register with Images
        </button>
        
        <!-- Camera Mode Button -->
        <button 
          *ngIf="registrationMode === 'camera'"
          class="btn btn-primary" 
          (click)="startRegistration()">
          üì∏ Start Face Scanning
        </button>
        
        <button class="btn btn-secondary" (click)="cancel()">
          Cancel
        </button>
      </div>
    </div>
  </div>

  <!-- Step 2: Scanning -->
  <div class="scanning-view" *ngIf="step === 'scanning'">
    <div class="video-container">
      <video #videoElement autoplay playsinline></video>
      <canvas #canvasElement style="display: none;"></canvas>
      
      <!-- Circular Progress Overlay -->
      <div class="circular-progress">
        <svg viewBox="0 0 200 200">
          <circle cx="100" cy="100" r="90" class="progress-bg"/>
          <circle 
            cx="100" 
            cy="100" 
            r="90" 
            class="progress-fill"
            [style.stroke-dashoffset]="565 - (565 * scanningProgress / 100)"
          />
        </svg>
        <div class="progress-text">
          {{ framesCollected }} / {{ targetFrames }}
        </div>
      </div>

      <!-- Instructions -->
      <div class="instructions">
        <p>{{ message }}</p>
        <p class="sub-text">Slowly rotate your head in a circle</p>
      </div>
    </div>
  </div>

  <!-- Step 3: Processing -->
  <div class="processing-view" *ngIf="step === 'processing'">
    <div class="card text-center">
      <div class="spinner-large"></div>
      <h3>{{ message }}</h3>
      <p>This may take a few seconds...</p>
    </div>
  </div>

  <!-- Step 4: Complete -->
  <div class="complete-view" *ngIf="step === 'complete'">
    <div class="card text-center success-card">
      <div class="success-icon">‚úÖ</div>
      <h3>Registration Complete!</h3>
      <p>{{ message }}</p>
      <button class="btn btn-primary" (click)="router.navigate(['/employees'])">
        View Employees
      </button>
    </div>
  </div>

  <!-- Step 5: Error -->
  <div class="error-view" *ngIf="step === 'error'">
    <div class="card text-center error-card">
      <div class="error-icon">‚ùå</div>
      <h3>Registration Failed</h3>
      <p>{{ errorMessage }}</p>
      <div class="button-group">
        <button class="btn btn-primary" (click)="reset()">
          Try Again
        </button>
        <button class="btn btn-secondary" (click)="cancel()">
          Cancel
        </button>
      </div>
    </div>
  </div>
</div>
